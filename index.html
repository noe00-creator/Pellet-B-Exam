<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PELLETB Practice Exam ‚Äî 5 Sections ‚Ä¢ 3 Hours (v10)</title>
  <style>
    :root{--bg:#0c0f1c;--card:#121836;--ink:#f7f9ff;--muted:#a9b3d0;--accent:#82a9ff;--good:#19d4a0;--bad:#ff5777}
    *{box-sizing:border-box}body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b5cff;color:var(--ink)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-weight:800;letter-spacing:.2px;margin:6px 0 12px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:18px;padding:16px 18px;box-shadow:0 18px 28px rgba(0,0,0,.28)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .badge{display:inline-flex;gap:8px;align-items:center;background:#0f1434;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
    button{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    button.primary{background:var(--accent);color:#0a1232}
    button.ghost{background:transparent;color:var(--ink);border:1px solid rgba(255,255,255,.18)}
    button.danger{background:var(--bad);color:#091222}
    button.good{background:var(--good);color:#04161a}
    button:disabled{opacity:.5;cursor:not-allowed}
    .section-tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px}
    .tab{background:#0f153f;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:12px;color:#b7c1e4;cursor:pointer;font-weight:700}
    .tab.active{background:var(--accent);color:#081334}
    .timer{font-variant-numeric:tabular-nums;font-weight:800}
    .q{margin:12px 0 18px}
    .q h3{margin:0 0 10px;font-size:18px}
    .opt{display:flex;gap:10px;align-items:flex-start;border:1px solid rgba(255,255,255,.14);padding:10px;border-radius:12px;margin:8px 0;background:#0c1237;cursor:pointer}
    .opt input{margin-top:2px}
    .controls{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px}
    .progress{height:8px;background:#0a0f28;border-radius:8px;overflow:hidden}
    .bar{height:8px;background:var(--accent);width:0}
    .muted{color:#a9b3d0}
    .small{font-size:12px;color:#a9b3d0}
    .banner{display:flex;gap:12px;align-items:center;justify-content:space-between;background:#0b1335;border:1px dashed rgba(255,255,255,.18);padding:10px 12px;border-radius:12px;margin:10px 0}
    .summary h2{margin:4px 0 10px}
    .summary .stat{display:inline-block;background:#0f153f;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:12px;margin-right:8px}
    .summary .miss{border:1px solid rgba(255,255,255,.15);padding:10px;border-radius:12px;margin:10px 0;background:#0b1233}
    .big-actions{display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <h1>PELLETB Practice Exam ‚Äî 5 Sections ‚Ä¢ 3 Hours (v10)</h1>
          <div class="row">
            <span class="badge"><strong>Total Time:</strong> <span class="timer" id="totalTimer">03:00:00</span></span>
            <span class="badge"><strong>Section Time:</strong> <span class="timer" id="sectionTimer">36:00</span></span>
            <span class="badge" id="scoreBadge">Score: 0</span>
          </div>
        </div>
        <div class="big-actions">
          <button class="good" id="saveBtn">üíæ Save & Pause</button>
          <button class="ghost" id="resumeBtn" style="display:none">‚ñ∂ Resume</button>
          <button class="danger" id="finishBtn">‚úî Finish & Review</button>
          <button class="ghost" id="resetBtn">‚ü≤ Reset All</button>
        </div>
      </div>

      <div class="banner" id="resumeBanner" style="display:none">
        <div>Saved progress detected. Resume exactly where you left off (time preserved per section).</div>
        <div class="row">
          <button class="good" id="resumeNow">Resume now</button>
          <button class="ghost" id="startOver">Start over</button>
        </div>
      </div>

      <div class="section-tabs" id="tabs"></div>
      <div id="screen"></div>
      <div class="controls" id="navControls">
        <div style="flex:1">
          <div class="progress"><div id="progressBar" class="bar"></div></div>
          <div class="small" id="progressText">Question 0 of 0</div>
        </div>
        <div class="row">
          <button class="ghost" id="prevBtn">‚óÄ Prev</button>
          <button class="primary" id="nextBtn">Next ‚ñ∂</button>
        </div>
      </div>
      <div class="small" style="margin-top:8px">Immediate feedback appears after selection. Use <strong>Save & Pause</strong> to preserve answers and exact remaining time.</div>
    </div>
  </div>

<script>
// ========= STORAGE & UTILS =========
const STORAGE_KEY = 'pelletb.practice.v10.fresh';
function $(id){return document.getElementById(id)}
function fmt(ms){ const s=Math.max(0,Math.floor(ms/1000)); const hh=String(Math.floor(s/3600)).padStart(2,'0'); const mm=String(Math.floor((s%3600)/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${hh}:${mm}:${ss}` }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr }
function uniquePush(store, key){ if(store.has(key)) return false; store.add(key); return true; }

// ========= SECTION 1: WRITING/GRAMMAR (50 unique)
function buildWriting(){
  const items=[]; const used = new Set();
  function add(prompt, choices, answer, explain){ const key=(prompt+'|'+choices.join('~')).toLowerCase(); if(!uniquePush(used,key)) return; items.push({type:'mc',prompt,choices,answer,explain}); }

  // Subject‚Äìverb agreement (parameterized fresh)
  const Q1Nouns=[['set','sets'],['series','series'],['pair','pairs'],['team','teams']];
  const Q1Ctx=['of radios','of keys','of cameras','of gloves'];
  for(let i=0;i<8;i++){
    const n=Q1Nouns[i%Q1Nouns.length]; const c=Q1Ctx[i%Q1Ctx.length];
    add(`Each ${n[1]} ${c} __ in the locker.`,
        ['are','is','were','be'],1,'‚ÄúEach‚Äù takes singular verb.');
  }

  // Commas & conjunctions
  const commaSeeds=[
    ['Officers searched the room and collected evidence.',['Officers searched the room and, collected evidence.','Officers searched the room and collected evidence.','Officers, searched the room and collected evidence.','Officers searched the room, and collected evidence.'],1],
    ['The hallway, which was quiet, led to the office.',['The hallway which was quiet led to the office.','The hallway, which was quiet, led to the office.','The hallway which, was quiet, led to the office.','The hallway which was quiet, led to the office.'],1],
    ['The door was damaged; however, the frame was intact.',['The door was damaged, however the frame was intact.','The door was damaged; however, the frame was intact.','The door was damaged however, the frame was intact.','The door was damaged; however the frame was intact.'],1]
  ];
  commaSeeds.forEach(s=>add('Choose the best sentence.', s[1], s[2], 'Comma/semicolon placement'));

  // Misplaced modifiers
  const objs=['camera','badge','locker','window','microphone','printer'];
  for(let i=0;i<12;i++){
    const o=objs[i%objs.length];
    add(`Walking down the corridor, the ${o} recorded clear audio.`,
        ['Walking down the corridor, the camera recorded clear audio.','The camera recorded clear audio while it walked down the corridor.','Walking down the corridor, clear audio was recorded by the camera.','A recording occurred while down the corridor.'],0,'Modifier must refer to the subject actually doing the action.');
  }

  // Parallelism
  const acts=[['photographing','collecting','labeling'],['interviewing','notifying','documenting'],['searching','securing','logging']];
  acts.forEach(a=>{
    add('Choose the most parallel phrasing.',
        [`The tasks included ${a[0]}, ${a[1]}, and ${a[2]}.`,`The tasks included to ${a[0]}, ${a[1]}, and ${a[2]}.`,`The tasks included ${a[0]}, to ${a[1]}, and ${a[2]}.`,`The tasks included ${a[0]} and ${a[1]} and ${a[2]}ing.`],0,'Use the same grammatical form in a series.');
  });

  // Pronoun/case & capitalization
  add('Choose the best sentence.', ['It was them who filed the report.','It was they who filed the report.','It was them whom filed the report.','It was him who filed the report.'],1,'Subjective case after a linking verb.');
  add('Choose the correctly capitalized sentence.', ['The officer read the advisement of rights.','The officer read the Advisement of rights.','The Officer read the advisement of Rights.','The officer read the Advisement Of Rights.'],0,'Only proper nouns/case titles need caps; generic phrase stays lowercase.');

  // Wordiness / active voice
  for(let i=0;i<10;i++){
    add('Choose the clearest, most concise option.',
        ['Officers detained the subject and conducted a search.','A detention of the subject was conducted by officers after which a search was completed.','The subject got detained and then the officers did a search thing.','A search occurred following a detention that was done.'],0,'Prefer active, concise wording.');
  }

  // Finish by adding extra unique repairs
  let n=0; while(items.length<50 && n<200){
    add('Choose the sentence with correct punctuation.',
        ['We canvassed the area, interviewed three witnesses, and secured the classroom.','We canvassed the area interviewed three witnesses, and secured the classroom.','We canvassed the area, interviewed three witnesses and, secured the classroom.','We canvassed, the area, interviewed three witnesses, and secured the classroom.'],0,'Serial comma and placement.');
    n++;
  }
  return items.slice(0,50);
}

// ========= SECTION 2: SPELLING (50 unique, MC)
function buildSpelling(){
  const bank=[
    'surveillance','possession','acquittal','liaison','subpoena','forfeiture','misdemeanor','separate','judgment','juvenile','burglary','robbery','narcotics','homicide','embezzlement','arraignment','probation','parole','contraband','trespassing','tactical','perimeter','investigation','aggregate','negligence','coercion','discrepancy','conspiracy','trespasser','confiscate','interrogation','corroborate','pertinent','apprehend','trespassed','trespasses','seizure','witnesses','incident','resistant','occurrence','license','vehicle','warehouse','survivor','accomplice','jurisdiction','venue','affidavit','stipulate'
  ];
  function variations(w){
    const out=new Set();
    // vowel swap
    out.add(w.replace(/a/g,'e')); out.add(w.replace(/e/g,'a'));
    // transposition of two middle letters
    if(w.length>4){ const i=Math.floor(w.length/2); out.add(w.slice(0,i-1)+w[i]+w[i-1]+w.slice(i+1)); }
    // duplicate drop
    for(let i=1;i<w.length;i++){ if(w[i]===w[i-1]){ out.add(w.slice(0,i)+w.slice(i+1)); break; } }
    // ph->f, sc->s, c->k (rough)
    out.add(w.replace('ph','f')); out.add(w.replace('sc','s')); out.add(w.replace(/c(?!h)/g,'k'));
    // tail removal
    out.add(w.replace(/e$/,''));
    return [...out].filter(v=>v.toLowerCase()!==w.toLowerCase() && v.length>2);
  }
  const items=[]; const used=new Set();
  for(const w of bank){ if(items.length>=50) break; const wrong=variations(w); while(wrong.length<3) wrong.push(w+w.slice(-1)); const opts=shuffle([w,wrong[0],wrong[1],wrong[2]]); const key=('sp|'+w+'|'+opts.join('~')).toLowerCase(); if(!uniquePush(used,key)) continue; items.push({type:'mc',prompt:'Choose the correct spelling.',choices:opts,answer:opts.indexOf(w),explain:'Correct: '+w}); }
  return items;
}

// ========= SECTION 3: READING (50 unique)
function buildReading(){
  const items=[]; const used=new Set();
  const times=["07:05","08:20","09:35","10:10","12:15","13:40","15:05","16:30","19:00","21:10"];
  const areas=['north stairwell','gym foyer','science wing','band room','bus loop','library stacks','cafeteria line','east parking lot','attendance office'];
  const vehicles=['compact car','pickup','SUV','minivan','motorcycle'];
  const colors=['blue','white','gray','red','silver','black'];
  const props=['tablet','wallet','phone','bike','laptop','backpack'];
  function Q(pass, stem, opts, ans, why){
    const key=(pass+'|'+stem+'|'+opts.join('~')).toLowerCase();
    if(!uniquePush(used,key)) return null;
    return {type:'mc',prompt:`Passage: ${pass} ${stem}`,choices:opts,answer:ans,explain:why};
  }
  function P1(){
    const t=times[Math.floor(Math.random()*times.length)], a=areas[Math.floor(Math.random()*areas.length)], c=colors[Math.floor(Math.random()*colors.length)], v=vehicles[Math.floor(Math.random()*vehicles.length)];
    const pass=`At ${t}, staff reported a loud bang near the ${a}. A ${c} ${v} was seen leaving at moderate speed. A side window in Room 112 had fresh cracks and glass inside.`;
    return Q(pass,'Which detail most indicates a break from the outside?', ['Time of day','Cracks in glass','Glass shards inside the room',`The ${c} ${v}`],2,'Glass inside suggests force from outside.');
  }
  function P2(){
    const a=areas[Math.floor(Math.random()*areas.length)];
    const pass=`Two students argued near the ${a}. No injuries occurred. When separated, both complied with staff directions and apologized.`;
    return Q(pass,'What is the most appropriate disposition?', ['Felony arrest','Document disturbance and notify admin/guardians','Ignore','Immediate trespass warning'],1,'Low-level disturbance: document and notify.');
  }
  function P3(){
    const pr=props[Math.floor(Math.random()*props.length)];
    const pass=`A custodian turned in a found ${pr} with a unique sticker and a student name etched on the case.`;
    return Q(pass,'What should be done first?', ['Erase the device to check contents','Book as evidence only','Attempt to contact the owner and log as found property','Discard after 48 hours'],2,'Attempt to return; log chain-of-custody.');
  }
  function P4(){
    const a=areas[Math.floor(Math.random()*areas.length)];
    const pass=`A smoke detector activated near the ${a}. No smoke visible; heat from a toaster in a lounge was reported.`;
    return Q(pass,'Best next step?', ['Evacuate, verify source, then reset per policy','Ignore','Call arson investigators immediately','Cite the nearest student'],0,'Follow alarm protocol.');
  }
  function P5(){
    const c=colors[Math.floor(Math.random()*colors.length)], pr=props[Math.floor(Math.random()*props.length)];
    const pass=`A ${pr} was missing from a desk; no pry marks; the door was propped open during lunch. A ${c} sweatshirt was mentioned by a witness.`;
    return Q(pass,'Which fact most weakens a burglary claim?', ['Door open during lunch','No pry marks','Value of item','Color of clothing'],1,'No forced entry ‚Üí likely theft, not burglary.');
  }
  const makers=[P1,P2,P3,P4,P5];
  while(items.length<50){ const f=makers[Math.floor(Math.random()*makers.length)]; const q=f(); if(q) items.push(q); }
  return items;
}

// ========= SECTION 4: REASONING (50 unique)
function buildReasoning(){
  const items=[]; const used=new Set();
  function add(stem, choices, answer){ const key=(stem+'|'+choices.join('~')).toLowerCase(); if(!uniquePush(used,key)) return; items.push({type:'mc',prompt:stem,choices,answer}); }

  // Syllogisms
  const cats=['delivery trucks','bicycles','scooters','campus carts','buses'];
  const zones=['Lane Beta','Quad South','Hallway West'];
  for(let i=0;i<10;i++){
    const A=cats[i%cats.length], Z=zones[i%zones.length];
    add(`No vehicles are allowed in ${Z}. All ${A} are vehicles. Which must be true?`,
        [`Some ${A} may use ${Z}.`,`No ${A} may use ${Z}.`,`Only emergency ${A} may use ${Z}.`,`${Z} is closed for repairs.`],1);
  }

  // Ordering: D first, A before B, C last
  for(let i=0;i<10;i++){
    const correct='D, A, B, C';
    const opts=shuffle([correct,'A, B, D, C','D, B, A, C','A, D, C, B']);
    add('Interviews must follow: D first; A before B; C last. Which order is valid?', opts, opts.indexOf(correct));
  }

  // Contrapositive
  for(let i=0;i<10;i++){
    add('If a student qualifies for a parking permit, then they are a senior. Taylor is not a senior. What can you conclude?',
        ['Taylor qualifies for a permit.','Taylor does not qualify for a permit.','Taylor has a permit.','Not enough information.'],1);
  }

  // Numeric/ratio
  for(let i=0;i<10;i++){
    const loop=25+5*i, window=120, loops=Math.floor(window/loop);
    add(`A patrol circles campus every ${loop} minutes from 08:00‚Äì10:00. How many complete loops occur?`,
        [String(loops),String(loops-1),String(loops+1),'Cannot be determined'],0);
  }

  // ‚ÄúExactly one true‚Äù
  for(let i=0;i<10;i++){
    add('Exactly one is true: (1) Hat. (2) Glasses. (3) Neither. Which is true?', ['(1)','(2)','(3)','None'],0);
  }
  return items;
}

// ========= SECTION 5: TERMINOLOGY & USAGE (50 unique)
function buildVocab(){
  const items=[]; const used=new Set();
  function add(prompt, choices, answer, explain){ const key=(prompt+'|'+choices.join('~')).toLowerCase(); if(!uniquePush(used,key)) return; items.push({type:'mc',prompt,choices,answer,explain}); }

  const defs=[
    ['probable cause','Facts that would make a reasonable person believe a crime was committed',['A hunch','Facts that would make a reasonable person believe a crime was committed','Proof beyond a reasonable doubt','Any anonymous tip']],
    ['reasonable suspicion','Specific, articulable facts suggesting criminal activity',['A gut feeling','Specific, articulable facts suggesting criminal activity','Court proof','A rumor']],
    ['exigent circumstances','Emergency conditions requiring immediate action',['Routine policy','Emergency requiring immediate action','Only court orders','Only when media present']],
    ['consensual encounter','Voluntary interaction where the person is free to leave',['A detention','Voluntary and free to leave','An arrest','A frisk']],
    ['chain of custody','Documentation tracking evidence handling',['A list of suspects','Documentation tracking evidence handling','An inventory of parking permits','A court calendar']],
    ['plain view doctrine','Item may be seized if officer is lawfully present and its nature is immediately apparent',['Anything seen anywhere','Only with a warrant','Seizable if lawfully present and immediately apparent','Only with consent']],
    ['disposition','Final outcome/handling of a call or case',['Officer feeling','Charge code','Final outcome/handling','Radio channel']],
    ['restitution','Payment to the victim for loss or damage',['Fine to government','Payment to the victim','Donation','Fee for report']],
    ['jurisdiction','Legal authority to act in an area or subject',['Moral authority','Wherever needed','Legal authority to act','Only school grounds']],
    ['venue','Place where the case is tried',['Police station','Scene of incident','Court where tried','Victim home']]
  ];

  // Add 30 definitions without replacement
  const defPool=[]; while(defPool.length<30){ const d=defs[Math.floor(Math.random()*defs.length)]; if(!defPool.includes(d)) defPool.push(d); }
  defPool.forEach(([t,correct,opts])=> add(`Definition: ‚Äú${t}‚Äù`, opts.slice(), opts.indexOf(correct)));

  // 20 scenario usage (fresh)
  const actors=['student','driver','visitor','employee','subject'];
  const locations=['north stairwell','west lot','front office','gym foyer','bus loop'];
  for(let i=0;i<20;i++){
    const a=actors[i%actors.length], L=locations[i%locations.length];
    add('Choose the most objective sentence.',
        [`The ${a} obviously lied.`,`The ${a} gave conflicting answers and avoided eye contact.`,`The ${a} was totally dishonest.`,`The ${a} seemed sketchy.`],1,'Describe observable facts, not opinions.');
    add('Choose the best concise report sentence.',
        [`The subject possessed a dark backpack.`,`The subject had a backpack that was black in color.`,`The subject had like a dark backpack thing.`,`A backpack item was possessed by the subject.`],0,'Concise and objective.');
    add('Best location phrasing.',
        [`Somewhere near the hall`,`${L}, third door on the left`,`Inside`,`Around the area`],1,'Specific beats vague.');
    if(items.length>=50) break;
  }
  return items.slice(0,50);
}

// ========= BUILD SECTIONS =========
const WRITING   = { id:'writing',   label:'Writing (Clarity & Grammar)', minutes:36, questions: buildWriting() };
const SPELLING  = { id:'spelling',  label:'Spelling (Law/LE Terms)', minutes:36, questions: buildSpelling() };
const READING   = { id:'reading',   label:'Reading Comprehension', minutes:36, questions: buildReading() };
const REASONING = { id:'reasoning', label:'Reasoning Ability', minutes:36, questions: buildReasoning() };
const VOCAB     = { id:'vocab',     label:'Terminology & Usage', minutes:36, questions: buildVocab() };
let SECTIONS = [WRITING, SPELLING, READING, REASONING, VOCAB];

// ========= STATE & TIMERS =========
const state = {sectionIndex:0, qIndex:0, answers:{}, running:true, lastTick:Date.now(), remainingMs:[]};
function initTimers(){ state.remainingMs = SECTIONS.map(()=>36*60*1000); state.lastTick = Date.now(); }
function sumRemaining(){ return state.remainingMs.reduce((a,b)=>a+b,0); }

// ========= SAVE/LOAD =========
function saveProgress(pause=true){
  const payload={
    version:'v10',
    sectionIndex: state.sectionIndex,
    qIndex: state.qIndex,
    answers: state.answers,
    remainingMs: state.remainingMs,
    sections: SECTIONS.map(s=>({id:s.id,label:s.label,minutes:s.minutes,questions:s.questions}))
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  if(pause){ state.running=false; $('resumeBtn').style.display='inline-block'; alert('Saved & paused. You can close the tab and resume later.'); }
}
function tryLoadSaved(){ const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return null; try{return JSON.parse(raw)}catch{ return null } }
function applySaved(saved, autoResume=true){
  if(!saved) return false;
  // Use saved questions and timers exactly
  SECTIONS = saved.sections;
  state.answers = saved.answers || {};
  state.sectionIndex = saved.sectionIndex || 0;
  state.qIndex = saved.qIndex || 0;
  state.remainingMs = Array.isArray(saved.remainingMs) && saved.remainingMs.length===SECTIONS.length ? saved.remainingMs : SECTIONS.map(()=>36*60*1000);
  state.lastTick = Date.now();
  if(autoResume){ state.running=true; $('resumeBanner').style.display='none'; $('resumeBtn').style.display='none'; }
  else { state.running=false; $('resumeBanner').style.display='flex'; $('resumeBtn').style.display='inline-block'; }
  return true;
}
function resetAll(){ localStorage.removeItem(STORAGE_KEY); location.reload(); }

// ========= INIT =========
function init(){
  const saved = tryLoadSaved();
  if(saved){ applySaved(saved,false); }
  else { initTimers(); }
  buildTabs(); render(); tick();
}

// ========= UI =========
function buildTabs(){ const tabs=$('tabs'); tabs.innerHTML=''; SECTIONS.forEach((sec,i)=>{ const b=document.createElement('button'); b.className='tab'+(i===state.sectionIndex?' active':''); b.textContent=`${i+1}. ${sec.label} (${sec.questions.length})`; b.onclick=()=>{ state.sectionIndex=i; state.qIndex=0; renderTabs(); render(); }; tabs.appendChild(b); }); }
function renderTabs(){ [...document.querySelectorAll('.tab')].forEach((el,idx)=> el.classList.toggle('active', idx===state.sectionIndex)); }

function render(){
  const sec=SECTIONS[state.sectionIndex]; const q=sec.questions[state.qIndex]; const sKey=`${sec.id}:${state.qIndex}`; const ans=state.answers[sKey];
  const answered = Object.keys(state.answers).length; const correctCnt = Object.values(state.answers).filter(a=>a.correct).length;
  $('scoreBadge').textContent=`Score: ${correctCnt}`;
  $('progressText').textContent=`Question ${state.qIndex+1} of ${sec.questions.length} (Section ${state.sectionIndex+1}/${SECTIONS.length}) ‚Ä¢ Answered: ${answered}/${SECTIONS.reduce((a,s)=>a+s.questions.length,0)}`;
  $('progressBar').style.width = `${(state.qIndex+1)/sec.questions.length*100}%`;

  const screen=$('screen'); screen.innerHTML=''; const qWrap=document.createElement('div'); qWrap.className='q'; const h=document.createElement('h3'); h.textContent=q.prompt; qWrap.appendChild(h);
  if(q.type==='mc'){
    q.choices.forEach((c,i)=>{
      const row=document.createElement('label'); row.className='opt';
      const radio=document.createElement('input'); radio.type='radio'; radio.name='mc'; radio.value=i; radio.checked = ans?.choice===i; radio.onchange=()=>gradeMC(i);
      const span=document.createElement('div'); span.textContent=c;
      row.appendChild(radio); row.appendChild(span); qWrap.appendChild(row);
      if(ans){ if(i===q.answer){ row.style.borderColor='rgba(25,212,160,.9)'; } if(ans.choice===i && i!==q.answer){ row.style.borderColor='rgba(255,87,119,.9)'; } }
    });
  }
  const exp=document.createElement('div'); exp.className='muted'; exp.style.marginTop='8px'; if(ans && q.explain){ exp.innerHTML = `<strong>Why:</strong> ${q.explain}`; } qWrap.appendChild(exp);
  screen.appendChild(qWrap);
  $('prevBtn').disabled = state.qIndex===0; $('nextBtn').disabled = state.qIndex===sec.questions.length-1;
}

function gradeMC(choiceIdx){ const sec=SECTIONS[state.sectionIndex]; const q=sec.questions[state.qIndex]; const key=`${sec.id}:${state.qIndex}`; const correct=(choiceIdx===q.answer); state.answers[key]={graded:true, choice:choiceIdx, correct}; render(); }

// ========= NAV + TIMERS =========
$('prevBtn').onclick=()=>{ if(state.qIndex>0){ state.qIndex--; render(); } };
$('nextBtn').onclick=()=>{ const sec=SECTIONS[state.sectionIndex]; if(state.qIndex<sec.questions.length-1){ state.qIndex++; render(); } };
$('finishBtn').onclick=()=> showSummary(); $('saveBtn').onclick=()=> saveProgress(true);
$('resumeBtn').onclick=()=> resumeNow(); $('resumeNow').onclick=()=> resumeNow(); $('startOver').onclick=()=> resetAll(); $('resetBtn').onclick=()=> resetAll();
function resumeNow(){ const saved=tryLoadSaved(); if(saved){ applySaved(saved,true); render(); tick(); }}

function tick(){ if(!state.running) return; const now=Date.now(); const dt = Math.max(0, now - state.lastTick); state.lastTick = now; state.remainingMs[state.sectionIndex] = Math.max(0, state.remainingMs[state.sectionIndex] - dt); if(state.remainingMs[state.sectionIndex]===0){ if(state.sectionIndex < SECTIONS.length-1){ state.sectionIndex++; state.qIndex=0; renderTabs(); } else { showSummary(true); return; } } $('totalTimer').textContent = fmt(sumRemaining()); $('sectionTimer').textContent = fmt(state.remainingMs[state.sectionIndex]); requestAnimationFrame(tick); }

// ========= SUMMARY =========
function showSummary(timeUp=false){ state.running=false; const screen=$('screen'); screen.innerHTML=''; $('navControls').style.display='none'; const wrapper=document.createElement('div'); wrapper.className='summary'; const totalQ = SECTIONS.reduce((a,s)=>a+s.questions.length,0); const correct = Object.values(state.answers).filter(a=>a.correct).length; const percent = Math.round((correct/totalQ)*100); const h2=document.createElement('h2'); h2.textContent = timeUp? 'Time! Results & Review':'Results & Review'; wrapper.appendChild(h2); const stats=document.createElement('div'); stats.innerHTML = `<span class="stat">Score: <strong>${correct}/${totalQ}</strong> (${percent}%)</span>` + SECTIONS.map((sec,i)=>{ const keys = Object.keys(state.answers).filter(k=>k.startsWith(sec.id+':')); const c = keys.filter(k=>state.answers[k]?.correct).length; return ` <span class="stat">${i+1}. ${sec.label}: <strong>${c}/${sec.questions.length}</strong></span>`; }).join(''); wrapper.appendChild(stats); const misses=[]; SECTIONS.forEach((sec)=>{ sec.questions.forEach((q,idx)=>{ const k=`${sec.id}:${idx}`; const a=state.answers[k]; if(!a || !a.correct){ misses.push({sec, q, idx, a}); } }) }); if(misses.length){ const t=document.createElement('h3'); t.textContent='Missed or Unanswered Questions'; wrapper.appendChild(t); misses.forEach(m=>{ const div=document.createElement('div'); div.className='miss'; const chosen = m.a?.choice!=null ? m.q.choices?.[m.a.choice] : '(no answer)'; let correctText = m.q.choices[m.q.answer]; div.innerHTML = `<strong>Section:</strong> ${m.sec.label}<br><strong>Question:</strong> ${m.q.prompt}<br><strong>Your answer:</strong> ${chosen}<br><strong>Correct:</strong> ${correctText}${m.q.explain? `<br><em>Why:</em> ${m.q.explain}`:''}`; wrapper.appendChild(div); }); }
  const actions=document.createElement('div'); actions.className='row'; const restart=document.createElement('button'); restart.className='ghost'; restart.textContent='Start a New Attempt'; restart.onclick=()=>{ resetAll(); }; const saveRep=document.createElement('button'); saveRep.className='primary'; saveRep.textContent='Save Results'; saveRep.onclick=()=>{ saveProgress(true); }; actions.appendChild(restart); actions.appendChild(saveRep); wrapper.appendChild(actions); screen.appendChild(wrapper); }

// ========= BOOT =========
window.addEventListener('beforeunload', ()=>{ if(state.running){ saveProgress(true); } });
init();
</script>
</body>
</html>
