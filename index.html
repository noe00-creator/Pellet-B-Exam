<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PELLETB Practice Exam â€” 5 Sections â€¢ 3 Hours (v9)</title>
  <style>
    :root{--bg:#0b1020;--card:#121936;--ink:#f6f8ff;--muted:#a9b3d0;--accent:#7aa2ff;--good:#1ad598;--bad:#ff5a7a}
    *{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0a0f1e,#0f1630);} 
    .wrap{max-width:1100px;margin:0 auto;padding:24px;color:var(--ink)}
    h1{font-weight:800;letter-spacing:.3px;margin:4px 0 12px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px 18px;box-shadow:0 12px 20px rgba(0,0,0,.25)}
    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:center}
    .badge{display:inline-flex;gap:8px;align-items:center;background:#0d1330;border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;color:#a9b3d0;font-size:12px}
    button{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    button.primary{background:var(--accent);color:#08112b}
    button.ghost{background:transparent;color:var(--ink);border:1px solid rgba(255,255,255,.15)}
    button.danger{background:var(--bad);color:#08112b}
    button.good{background:var(--good);color:#04141a}
    button:disabled{opacity:.5;cursor:not-allowed}
    .section-tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px}
    .tab{background:#0e1440;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;color:#a9b3d0;cursor:pointer;font-weight:700}
    .tab.active{background:var(--accent);color:#070e28}
    .timer{font-variant-numeric:tabular-nums;font-weight:800}
    .q{margin:12px 0 18px}
    .q h3{margin:0 0 10px;font-size:18px}
    .opt{display:flex;gap:10px;align-items:flex-start;border:1px solid rgba(255,255,255,.12);padding:10px;border-radius:12px;margin:8px 0;background:#0c1234;cursor:pointer}
    .opt input{margin-top:2px}
    .controls{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px}
    .progress{height:8px;background:#0a0f28;border-radius:8px;overflow:hidden}
    .bar{height:8px;background:var(--accent);width:0}
    .muted{color:#a9b3d0}
    .small{font-size:12px;color:#a9b3d0}
    .banner{display:flex;gap:12px;align-items:center;justify-content:space-between;background:#09102c;border:1px dashed rgba(255,255,255,.18);padding:10px 12px;border-radius:12px;margin:10px 0}
    .summary h2{margin:4px 0 10px}
    .summary .stat{display:inline-block;background:#0e1440;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;margin-right:8px}
    .summary .miss{border:1px solid rgba(255,255,255,.15);padding:10px;border-radius:12px;margin:10px 0;background:#0b1233}
    .big-actions{display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <h1>PELLETB Practice Exam â€” 5 Sections â€¢ 3 Hours (v9)</h1>
          <div class="row">
            <span class="badge"><strong>Total Time:</strong> <span class="timer" id="totalTimer">03:00:00</span></span>
            <span class="badge"><strong>Section Time:</strong> <span class="timer" id="sectionTimer">36:00</span></span>
            <span class="badge" id="scoreBadge">Score: 0</span>
          </div>
        </div>
        <div class="big-actions">
          <button class="good" id="saveBtn">ðŸ’¾ Save & Pause</button>
          <button class="ghost" id="resumeBtn" style="display:none">â–¶ Resume</button>
          <button class="danger" id="finishBtn">âœ” Finish & Review</button>
        </div>
      </div>

      <div class="banner" id="resumeBanner" style="display:none">
        <div>Saved progress detected. Resume where you left off with your remaining time intact.</div>
        <div class="row">
          <button class="good" id="resumeNow">Resume now</button>
          <button class="ghost" id="startOver">Start over</button>
        </div>
      </div>

      <div class="section-tabs" id="tabs"></div>
      <div id="screen"></div>
      <div class="controls" id="navControls">
        <div style="flex:1">
          <div class="progress"><div id="progressBar" class="bar"></div></div>
          <div class="small" id="progressText">Question 0 of 0</div>
        </div>
        <div class="row">
          <button class="ghost" id="prevBtn">â—€ Prev</button>
          <button class="primary" id="nextBtn">Next â–¶</button>
        </div>
      </div>
      <div class="small" style="margin-top:8px">Immediate feedback appears after you answer. Use <strong>Save & Pause</strong> to preserve answers and the exact remaining time.</div>
    </div>
  </div>

<script>
// ========= STORAGE & UTILS =========
const STORAGE_KEY = 'pelletb.practice.v9.unique.everywhere';
function $(id){return document.getElementById(id)}
function fmt(ms){ const s=Math.max(0,Math.floor(ms/1000)); const hh=String(Math.floor(s/3600)).padStart(2,'0'); const mm=String(Math.floor((s%3600)/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${hh}:${mm}:${ss}` }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr }
function choice(arr){ return arr[Math.floor(Math.random()*arr.length)] }

// ========= SECTION 1: WRITING (50 unique) =========
function buildWriting(){
  const items=[]; const used=new Set();
  function add(prompt, choices, answer, explain, id){ const key=(id||prompt).toLowerCase(); if(used.has(key)) return; used.add(key); items.push({type:'mc', prompt, choices, answer, explain}); }

  // Families with parameterization to exceed 50 uniques
  const quantifiers=['Each','Every','Neither','Either','A number of','The number of'];
  const plurals=['reports','students','witnesses','backpacks','complaints','cameras'];
  const singulars=['report','student','witness','backpack','complaint','camera'];
  for(let i=0;i<plurals.length;i++){
    add(`${quantifiers[0]} of the ${plurals[i]} have a signature.`,
        [`${quantifiers[0]} of the ${plurals[i]} have a signature.`,`${quantifiers[0]} of the ${plurals[i]} has a signature.`,`${quantifiers[0]} of the ${singulars[i]} have a signature.`,`${quantifiers[0]} of the ${singulars[i]} has a signature.`],1,'Subjectâ€“verb agreement','sv-each-'+i);
  }
  const pairs=[['witnesses','suspect'],['officers','sergeant'],['students','principal']];
  pairs.forEach((p,ix)=>{
    add(`Neither the ${p[0]} nor the ${p[1]} are available.`,
        [`Neither the ${p[0]} nor the ${p[1]} are available.`,`Neither the ${p[0]} nor the ${p[1]} is available.`,`Neither the ${p[1]} nor the ${p[0]} were available.`,`Neither the ${p[0]} nor the ${p[1]} be available.`],1,'Agreement with nearest subject','sv-neither-'+ix);
  });
  const commaStems=[
    ['We arrived and cleared the hallway.','We arrived and, cleared the hallway.','We arrived and cleared the hallway.','We arrived, and cleared the hallway.','We, arrived and cleared the hallway.'],
    ['Mr. Lopez, who teaches math, called 911.','Mr. Lopez who teaches math called 911.','Mr. Lopez, who teaches math, called 911.','Mr. Lopez who teaches math, called 911.','Mr. Lopez, who teaches math called 911.'],
    ['The door was forced open; however, the frame was fine.','The door was forced open however the frame was fine.','The door was forced open; however, the frame was fine.','The door was forced open, however, the frame was fine.','The door was forced open however, the frame was fine.']
  ];
  commaStems.forEach((set,ix)=> add(set[0], set.slice(1,5), 1,'Comma/semicolon placement','comma-'+ix));

  const clarity=[
    ['After Officer Diaz concluded the interview, she wrote the report.',
     'Having concluded the interview, the report was written by Officer Diaz.','After Officer Diaz concluded the interview, she wrote the report.','The report was written after concluding the interview by Officer Diaz.','After concluding, the report was written.'],
    ['As they entered the room, they saw a backpack.',
     'As they entered, the room they saw a backpack.','As they entered the room, they saw a backpack.','They entered the room they saw a backpack.','As they entered the room they saw a backpack.']
  ];
  clarity.forEach((set,ix)=> add(set[0], set.slice(1,5), 1,'Clarity and misplaced modifiers','clarity-'+ix));

  const hyphen=[
    ['a well-known student',['a well known student','a well-known student','a well known-student','a well- known student']],
    ['ten-minute response time',['ten minute response time','ten-minute response time','ten minute-response time','ten-minute- response time']]
  ];
  hyphen.forEach((h,ix)=> add(`Choose the best form: â€œ${h[0]}â€`, h[1], 1,'Hyphenation of compound modifiers','hy-'+ix));

  // Tone / objective language
  const tones=[
    ['The subject became visibly agitated.',['The perp totally freaked out.','The subject became visibly agitated.','The dude got mad.','The suspect was like, angry.']],
    ['Noise levels were high; classes were disrupted.', ['The hallway was crazy loud and super annoying.','Noise levels were high; classes were disrupted.','The hallway was insane loud.','The hallway was annoying loudness wise.']]
  ];
  tones.forEach((t,ix)=> add('Choose the best report phrasing.', t[1], 1,'Professional tone','tone-'+ix));

  // Comma splice repairs (parameterized)
  const actions=[['arrived','cleared the room'],['interviewed','wrote the report'],['observed','detained the subject'],['searched','recovered property']];
  actions.forEach((a,ix)=>{
    add(`We ${a[0]}, we ${a[1]}.`,
        [`We ${a[0]}; we ${a[1]}.`,`We ${a[0]}, we ${a[1]}.`,`We ${a[0]} however we ${a[1]}.`,`We ${a[0]}, and we ${a[1]}.`],0,'Fix runâ€‘on/comma splice','splice-'+ix);
  });

  // Pronoun case / capitalization
  const misc=[
    ['It was they who filed the report.', ['It was them who filed the report.','It was they who filed the report.','It was them whom filed the report.','It was him who filed the report.'],1,'Pronoun case','pro-1'],
    ['The officer read the Miranda rights.', ['The officer read the miranda rights','The officer read the Miranda rights','The Officer read the Miranda Rights','The officer read the miranda Rights'],1,'Capitalization','cap-1']
  ];
  misc.forEach((m,ix)=> add('Choose the best sentence.', m[1], m[2], m[3], m[4]));

  // Generate additional unique SV agreement via data/plural nouns
  const massNouns=['data','evidence','media'];
  massNouns.forEach((n,ix)=> add(`The ${n} show a decline.`,[`The ${n} shows a decline.`,`The ${n} show a decline.`,`The ${n} are shows a decline.`,`The ${n}s show a decline.`],1,'Mass noun agreement','mass-'+ix));

  // Expand until 50 by permuting clarity/tone actions
  let i=0;
  while(items.length<50 && i<200){
    const obj=['backpack','door','window','camera','locker'][i%5];
    add(`Walking down the hall, the ${obj} recorded the suspect.`,
        ['Walking down the hall, the camera recorded the suspect.','Walking down the hall, officers recorded the suspect on camera.','Walking down the hall, the suspect was recorded by the camera system.','Walking down the hall, a recording occurred of the suspect.'],
        1,'Misplaced modifier','mm-'+i);
    i++;
  }
  return items.slice(0,50);
}

// ========= SECTION 2: SPELLING (MC; 50 items) =========
function buildSpelling(){
  const words = [
    'subpoena','paraphernalia','surveillance','possession','occurred','warrant','pursue','forfeiture','acquittal','liaison','seized','misdemeanor','separate','license','Miranda','resistance','violation','juvenile','judgment','warehouse','perpetrator','trespassing','contraband','burglary','robbery','tactical','narcotics','homicide','embezzlement','arraignment','custody','probation','parole','trespasser','trespass','investigation','investigate','perimeter','discrepancy','coercion','negligence','contradictory','arson','vandalism','trespassed','trespasses','survivor','accomplice','confiscate','witness'
  ];
  function dropDouble(w){ for(let i=1;i<w.length;i++){ if(w[i]===w[i-1]) return w.slice(0,i)+w.slice(i+1);} return w; }
  function misspell(w){ const v=new Set(); v.add(w.replace(/ie/g,'ei')); v.add(w.replace(/ei/g,'ie')); v.add(dropDouble(w)); v.add(w.replace(/ph/g,'f')); v.add(w.replace(/c/g,'s')); v.add(w.replace(/e$/,'')); return [...v].filter(x=>x.toLowerCase()!==w.toLowerCase() && x.length>2); }
  const items=[]; words.slice(0,50).forEach(w=>{ let ds=misspell(w); while(ds.length<3){ ds.push(w+'e'); } const opts=shuffle([w,ds[0],ds[1],ds[2]]); items.push({type:'mc', prompt:'Choose the correct spelling.', choices:opts, answer:opts.indexOf(w), explain:'Correct: '+w}); }); return items;
}

// ========= SECTION 3: READING (50 unique scenarios) =========
function buildReading(){
  const items=[]; const used=new Set();
  const times=["0715","0830","0945","1040","1210","1345","1515","1640","1905","2110","2240"]; 
  const streets=["1st St","2nd St","Pine St","Maple Ave","Cedar Blvd","Oak St","Elm Rd","Grant St","Atlantic Blvd","Garfield Ave","Florence Ave","Paramount Blvd","Lakewood Blvd","Imperial Hwy","Firestone Blvd"]; 
  const colors=["blue","white","black","silver","red","green","gray"]; 
  const vehicles=["sedan","SUV","pickup","minivan","hatchback","motorcycle"]; 
  const rooms=["library","gym","cafeteria","science lab","auditorium","classroom 204","nurse's office"]; 
  const graffitiTags=["T3K","LXN","RIVR","ECHO","K-12","NOVA"]; 
  const props=["backpack","laptop","wallet","phone","bicycle","tablet"]; 
  function q(pass, stem, opts, ans, why){ return {type:'mc', prompt:`Passage: ${pass} ${stem}`, choices:opts, answer:ans, explain:why}; }
  function uniqId(parts){return parts.join('|').toLowerCase()}
  function makeBurglary(){ const t=choice(times), st=choice(streets), col=choice(colors), veh=choice(vehicles); const pass=`At ${t} hrs, officers responded to ${Math.floor(Math.random()*900)+100} ${st}. A window was shattered and drawers were open. A neighbor saw a ${col} ${veh} leave westbound.`; const stem=`Which detail best supports forced entry?`; const opts=['Time of call','Shattered window','Open drawers',`The ${col} ${veh}`]; return q(pass, stem, opts, 1, 'Shattered window indicates entry by force.'); }
  function makeSuspicious(){ const rm=choice(rooms), st=choice(streets); const pass=`Campus security reported a suspicious person loitering near the ${rm} at a school on ${st}. The subject avoided staff, kept hands in pockets, and tried doors.`; const stem=`What is the most prudent first action?`; const opts=['Immediate arrest','Detain with reasonable suspicion and conduct a pat search if justified','Ignore because subject left','Broadcast BOLO without contact']; return q(pass, stem, opts, 1, 'Detain based on specific, articulable facts; pat if R/S for weapons.'); }
  function makeTraffic(){ const col=choice(colors); const pass=`During a traffic stop for speed, the driver had trembling hands, strong alcohol odor, and ${col} paint transfer on the bumper.`; const stem=`Which observation most indicates DUI impairment?`; const opts=['Paint transfer','Trembling hands','Alcohol odor','Speeding ticket history']; return q(pass, stem, opts, 2, 'Alcohol odor + driving pattern supports DUI investigation.'); }
  function makeFireAlarm(){ const rm=choice(rooms); const pass=`Fire alarm activated near the ${rm}. No smoke visible; heat from a microwave was reported. Students were calm.`; const stem=`What is the best next step?`; const opts=['Evacuate, verify source, and reset alarm per policy','Ignore and resume class','Cite student for vandalism','Call arson unit immediately']; return q(pass, stem, opts, 0, 'Follow evacuation/verification protocol.'); }
  function makeLostChild(){ const st=choice(streets); const pass=`A 6â€‘yearâ€‘old was found near ${st} unable to state address. He knows his teacherâ€™s name and bus color.`; const stem=`What detail is most useful to reunite the child?`; const opts=['Teacherâ€™s name','Age','Bus color','Clothing color']; return q(pass, stem, opts, 0, 'Teacherâ€™s name narrows class/school roster.'); }
  function makeGraffiti(){ const tag=choice(graffitiTags); const st=choice(streets); const pass=`Fresh sprayâ€‘paint with tag â€œ${tag}â€ was found on the east wall of a campus on ${st}. A custodial cart camera faces the wall.`; const stem=`What is the best immediate evidence step?`; const opts=['Pressureâ€‘wash immediately','Collect paint chips only','Pull and preserve camera footage covering the time window','Notify social media team']; return q(pass, stem, opts, 2, 'Video corroborates time and suspect identity; preserve quickly.'); }
  function makeLockerTheft(){ const prop=choice(props); const pass=`Student reported ${prop} missing from an unlocked locker after lunch. No pry marks observed.`; const stem=`Which fact most weakens a burglary claim?`; const opts=['Missing during lunch','No pry marks','High value item','Crowded hallway']; return q(pass, stem, opts, 1, 'No forced entry suggests theft, not burglary.'); }
  function makeMedical(){ const pass=`Teacher fainted during class. Breathing normal; pulse rapid; no head trauma. AED nearby.`; const stem=`What is the priority?`; const opts=['Start chest compressions','Place in recovery position and monitor breathing, summon EMS','Give water immediately','Move the teacher to hallway']; return q(pass, stem, opts, 1, 'Airway/breathing; recovery position and EMS.'); }
  function makeCafeteria(){ const pass=`Two students argued in the cafeteria; one knocked a tray, no injuries, both calmed when separated.`; const stem=`Most appropriate disposition?`; const opts=['Felony battery arrest','Detention and notify parents/admin; document as disturbance','No documentation','Issue trespass warnings']; return q(pass, stem, opts, 1, 'Document disturbance; involve admin/parents.'); }
  function makeFoundProperty(){ const prop=choice(props); const st=choice(streets); const pass=`A custodian turned in a found ${prop} with student ID sticker in the hallway near ${st}.`; const stem=`Best first step?`; const opts=['Store indefinitely','Attempt to contact owner via ID and log property','Erase device to check contents','Discard after 24 hours']; return q(pass, stem, opts, 1, 'Contact owner and log chain-of-custody.'); }
  function makeBike(){ const col=choice(colors); const pass=`A ${col} bicycle was reported missing from the rack; the lock was cut and pieces were on the ground.`; const stem=`Which evidence is most probative to collect first?`; const opts=['Witness names','Lock fragments and any tool marks','General photos only','Ownerâ€™s prior theft report']; return q(pass, stem, opts, 1, 'Tool marks may link to suspect/tool.'); }
  const factories=[makeBurglary,makeSuspicious,makeTraffic,makeFireAlarm,makeLostChild,makeGraffiti,makeLockerTheft,makeMedical,makeCafeteria,makeFoundProperty,makeBike];
  while(items.length<50){ const f=choice(factories); const item=f(); const uid=(item.prompt+item.choices.join('~')).toLowerCase(); if(used.has(uid)) continue; used.add(uid); items.push(item);} return shuffle(items);
}

// ========= SECTION 4: REASONING (50, replaced) =========
function buildReasoning(){
  const items=[]; const used=new Set();
  function Q(stem, opts, ans){ const key=(stem+'|'+opts.join('~')).toLowerCase(); if(used.has(key)) return null; used.add(key); return {type:'mc', prompt:stem, choices:opts, answer:ans}; }
  function push(q){ if(q) items.push(q); }
  const cats=['trucks','bicycles','scooters','buses','drones','skateboards']; const lanes=['Lane 2','Quad A','Hallway C'];
  for(let i=0;i<10;i++){ const A=cats[i%cats.length], place=lanes[i%lanes.length]; push(Q(`No vehicles are allowed in ${place}. All ${A} are vehicles. Which statement is true?`,[`Some ${A} may use ${place}.`,`No ${A} may use ${place}.`,`Only emergency ${A} may use ${place}.`,`${place} is closed for repairs.`],1)); }
  for(let i=0;i<8;i++){ const correct='D, A, B, C'; const opts=shuffle([correct,'A, B, D, C','D, B, A, C','A, D, C, B']); push(Q('Interviews must follow: D first; A before B; C last. Which order is valid?', opts, opts.indexOf(correct))); }
  const colors=['red','blue','green'];
  for(let i=0;i<8;i++){ const a=colors[i%3], b=colors[(i+1)%3], c=colors[(i+2)%3]; const stem=`Three students each wear a different badge: ${a}, ${b}, and ${c}. Alex is not ${a}. Blake is not ${b}. Casey is not ${c}. Who wears ${a}?`; const correct='Blake'; const opts=shuffle(['Alex','Blake','Casey','Cannot be determined']); push(Q(stem, opts, opts.indexOf(correct))); }
  for(let i=0;i<8;i++){ const patrol=30+5*i; const window=120; const loops=Math.floor(window/patrol); const stem=`A patrol unit circles the campus every ${patrol} minutes from 08:00 to 10:00. How many complete loops occur in that window?`; const correct=String(loops); const opts=shuffle([correct,String(loops-1),String(loops+1),'Cannot be determined']); push(Q(stem, opts, opts.indexOf(correct))); }
  for(let i=0;i<8;i++){ const stem='If a student is eligible for a parking permit, then they are a senior. Jordan is not a senior. What can be concluded?'; const opts=['Jordan is eligible for a permit.','Jordan is not eligible for a permit.','Jordan has a permit.','Not enough information.']; push(Q(stem, opts, 1)); }
  for(let i=0;i<8;i++){ const stem='Exactly one of the following is true: (1) The suspect wore a hat. (2) The suspect wore glasses. (3) The suspect wore neither. Which statement is true?'; const opts=['(1)','(2)','(3)','None']; push(Q(stem, opts, 0)); }
  let n=0; while(items.length<50 && n<50){ const a=10+n, b=5+(n%7); const mult=a*b; const stem=`Every ${a}th locker is inspected. The ${mult}th locker is inspected. Which other locker is also inspected?`; const correct=String(a*(b+1)); const opts=shuffle([correct,String(mult-1),String(mult+2),String(a+b)]); push(Q(stem, opts, opts.indexOf(correct))); n++; }
  return shuffle(items).slice(0,50);
}

// ========= SECTION 5: VOCAB & REPORT USAGE (50, replaced) =========
function buildVocab(){
  // Build without replacement: 30 defs + 20 usage
  const defs=[
    ['probable cause','Facts that would lead a reasonable person to believe a crime was committed',['A mere hunch','Facts that would lead a reasonable person to believe a crime was committed','Proof beyond a reasonable doubt','Any anonymous tip']],
    ['reasonable suspicion','Specific, articulable facts that criminal activity is afoot',['A gut feeling','Specific, articulable facts that criminal activity is afoot','Proof beyond a reasonable doubt','An anonymous rumor']],
    ['exigent circumstances','Emergency conditions requiring immediate action',['Routine circumstances','Emergency conditions requiring immediate action','Court orders','Witness interviews']],
    ['Miranda warning','Advisement of rights before custodial interrogation',['Any field interview','Advisement of rights before custodial interrogation','Only for juveniles','Only for felonies']],
    ['custody (legal)','A formal arrest or restraint on freedom of movement of the degree associated with formal arrest',['Any detention','A formal arrest or equivalent restraint','A consensual encounter','Officer presence only']],
    ['consensual encounter','A voluntary interaction where the person is free to leave',['A detention','A voluntary interaction where the person is free to leave','An arrest','A probation search']],
    ['detention','A brief stop based on reasonable suspicion',['A brief stop based on reasonable suspicion','A custodial arrest','A ticket only','A casual chat']],
    ['search incident to arrest','Search of arrestee and area within immediate control',['Search of any vehicle','Search of arrestee and lunge area','Consent search','Inventory only']],
    ['plain view doctrine','Seizable if officer lawfully present, item immediately apparent as evidence/contraband',['Anything visible anywhere','Only with a warrant','Seizable if officer lawfully present and itâ€™s immediately apparent','Only with consent']],
    ['chain of custody','Documentation of evidence from collection to court',['List of suspects','Documentation of evidence from collection to court','Court calendar','CAD incident log']],
    ['contraband','Illegal or prohibited items',['Any property','Illegal or prohibited items','Lost property','Found property only']],
    ['restitution','Payment to victim for loss/damage',['Fine to the court','Payment to victim for loss/damage','Donation','Seizure']],
    ['disposition','Final handling/outcome of a case or call',['Officerâ€™s opinion','Final handling/outcome','Initial response code','Offense definition']],
    ['use of force continuum','Framework guiding proportional force options',['Mandatory escalation','Framework guiding proportional force options','Only lethal force','Verbal commands only']],
    ['perimeter','Boundary established to control access',['Interior search pattern','Boundary to control access','Only crime scene tape','Room corners']],
    ['Terry frisk','Pat-down for weapons based on reasonable suspicion the person is armed and dangerous',['Full search','Pat-down for weapons with R/S armed & dangerous','Consent search','Inventory search']],
    ['fruit of the poisonous tree','Evidence derived from an illegal search is inadmissible unless an exception applies',['Always admissible','Never applicable to statements','Inadmissible unless exception','Applies only to vehicles']],
    ['exclusionary rule','Suppresses evidence obtained in violation of the Constitution',['Allows all evidence','Suppresses illegally obtained evidence','Only for civil cases','Only excludes statements']],
    ['objective reporting','Facts observed, heard, or measured without opinion or emotion',['Officerâ€™s impression','Speculation','Objective facts','Colloquial phrasing']],
    ['BOLO (Be On the Lookout)','Broadcast describing person/vehicle of interest',['Booking form','Evidence form','Broadcast alert','Medical form']],
    ['NCIC/CLETS hit','Database return indicating record/warrant/stolen',['A parking citation','A radio test','A database record hit','A court subpoena']],
    ['booked into evidence','Logged, packaged, and stored with chain-of-custody',['Photographed only','Left at scene','Logged and secured with paperwork','Given to owner immediately']],
    ['report addendum','Supplemental report adding details after the original',['A new unrelated report','A memo to supervisor','Supplement to original report','CAD note only']],
    ['field interview card','Short form documenting person/vehicle contact',['Parking slip','Evidence receipt','FI documentation','Witness subpoena']],
    ['pretext stop','Stop for a minor violation while investigating another suspicion',['Only DUI checkpoints','A random stop','Stop for minor violation while investigating another suspicion','Felony stop only']],
    ['prima facie','On its face; sufficient to establish a fact unless disproved',['At the end','Hidden','On its face','After review']],
    ['stipulate','To agree to a fact on the record',['To arrest','To dispute','To agree on the record','To subpoena']],
    ['affidavit','A written statement confirmed by oath or affirmation',['A verbal statement','An anonymous tip','A written statement under oath','A subpoena']],
    ['subpoena','A writ ordering a person to attend court',['A probation order','A fine','A writ ordering attendance','A warning']],
    ['jurisdiction','Legal authority to act in a geographical area or subject matter',['Any area','Moral authority','Legal authority to act','Only school grounds']],
    ['venue','Location where a case is tried',['Police station','Scene of incident','Location where tried','Victimâ€™s residence']]
  ];

  // Usage templates parameterized to guarantee 20 unique
  const actors=['student','subject','driver','witness','suspect'];
  const weapons=['knife','handgun','baton','pepper spray'];
  const locations=['north stairwell','gym entrance','parking lot','C-204','front office'];
  const usage=[];
  for(let i=0;i<actors.length;i++){
    usage.push(['Best objective phrasing.', [
      `The ${actors[i]} obviously lied.`,
      `The ${actors[i]} avoided eye contact and gave inconsistent answers.`,
      `The ${actors[i]} seemed shady.`,
      `The ${actors[i]} was totally dishonest.`],1]);
    usage.push(['Choose the clearest, concise report sentence.', [
      `The suspect had a ${weapons[i%weapons.length]}, which was black in color.`,
      `The suspect possessed a black ${weapons[i%weapons.length]}.`,
      `The suspect had a weapon thing that was black.`,
      `The suspect had a super dark weapon.`],1]);
    usage.push(['Most precise location language.', [
      `Near the place somewhere`,
      `${locations[i]} (exact)`,
      `In the building`,
      `Around the hallway`],1]);
    usage.push(['Best chain-of-custody language.', [
      `Evidence was handed around the room.`,
      `Evidence remained under Officer Perezâ€™s control until booked.`,
      `Everyone touched the bag.`,
      `The bag was on a desk.`],1]);
  }

  // Build without replacement
  const items=[];
  const defPool = defs.slice(); shuffle(defPool);
  defPool.slice(0,30).forEach(([t,d,opts])=>{ const arr=opts.slice(); items.push({type:'mc', prompt:`Definition: â€œ${t}â€`, choices:arr, answer:arr.indexOf(d)}); });
  const usePool = usage.slice(); shuffle(usePool);
  usePool.slice(0,20).forEach(([p,opts,ans])=> items.push({type:'mc', prompt:p, choices:opts, answer:ans}));
  return items;
}

// ========= BUILD SECTIONS =========
const WRITING   = { id:'writing',   label:'Writing (Clarity & Grammar)', minutes:36, questions: buildWriting() };
const SPELLING  = { id:'spelling',  label:'Spelling (Common LE/Legal Words)', minutes:36, questions: buildSpelling() };
const READING   = { id:'reading',   label:'Reading Comprehension', minutes:36, questions: buildReading() };
const REASONING = { id:'reasoning', label:'Reasoning Ability', minutes:36, questions: buildReasoning() };
const VOCAB     = { id:'vocab',     label:'Vocabulary & Report Usage (LE Terms)', minutes:36, questions: buildVocab() };
let SECTIONS = [WRITING, SPELLING, READING, REASONING, VOCAB];

// ========= STATE =========
const state = {sectionIndex:0, qIndex:0, answers:{}, running:true, lastTick:Date.now(), remainingMs:[], TOTAL_MINUTES:180};

// ========= TIMERS =========
function initTimersFromScratch(){ state.remainingMs = SECTIONS.map(()=>36*60*1000); state.lastTick = Date.now(); }
function sumRemaining(){ return state.remainingMs.reduce((a,b)=>a+b,0); }
function saveProgress(pause=true){ const payload={ version:8, sectionIndex: state.sectionIndex, qIndex: state.qIndex, answers: state.answers, remainingMs: state.remainingMs, sections: SECTIONS }; localStorage.setItem(STORAGE_KEY, JSON.stringify(payload)); if(pause){ state.running=false; $('resumeBtn').style.display='inline-block'; alert('Saved & paused. You can close the tab and resume later.'); } }
function tryLoadSaved(){ const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return null; try{return JSON.parse(raw)}catch{ return null } }
function applySaved(saved, autoResume=true){ if(!saved) return false; SECTIONS = saved.sections||SECTIONS; state.answers=saved.answers||{}; state.sectionIndex=saved.sectionIndex||0; state.qIndex=saved.qIndex||0; state.remainingMs = Array.isArray(saved.remainingMs)&&saved.remainingMs.length===SECTIONS.length ? saved.remainingMs : SECTIONS.map(()=>36*60*1000); state.lastTick=Date.now(); if(autoResume){ state.running=true; $('resumeBanner').style.display='none'; $('resumeBtn').style.display='none'; } else { state.running=false; $('resumeBanner').style.display='flex'; $('resumeBtn').style.display='inline-block'; } return true; }
function resetAll(){ localStorage.removeItem(STORAGE_KEY); location.reload(); }

function init(){ const saved = tryLoadSaved(); if(saved){ applySaved(saved,false); } else { initTimersFromScratch(); } buildTabs(); render(); tick(); }

// ========= UI =========
function buildTabs(){ const tabs=$('tabs'); tabs.innerHTML=''; SECTIONS.forEach((sec,i)=>{ const b=document.createElement('button'); b.className='tab'+(i===state.sectionIndex?' active':''); b.textContent=`${i+1}. ${sec.label} (${sec.questions.length})`; b.onclick=()=>{ state.sectionIndex=i; state.qIndex=0; renderTabs(); render(); }; tabs.appendChild(b); }); }
function renderTabs(){ [...document.querySelectorAll('.tab')].forEach((el,idx)=> el.classList.toggle('active', idx===state.sectionIndex)); }
function render(){ const sec=SECTIONS[state.sectionIndex]; const q=sec.questions[state.qIndex]; const sKey=`${sec.id}:${state.qIndex}`; const ans=state.answers[sKey]; const answered = Object.keys(state.answers).length; const correctCnt = Object.values(state.answers).filter(a=>a.correct).length; $('scoreBadge').textContent=`Score: ${correctCnt}`; $('progressText').textContent=`Question ${state.qIndex+1} of ${sec.questions.length} (Section ${state.sectionIndex+1}/${SECTIONS.length}) â€¢ Answered: ${answered}/${SECTIONS.reduce((a,s)=>a+s.questions.length,0)}`; $('progressBar').style.width = `${(state.qIndex+1)/sec.questions.length*100}%`; const screen=$('screen'); screen.innerHTML=''; const qWrap=document.createElement('div'); qWrap.className='q'; const h=document.createElement('h3'); h.textContent=q.prompt; qWrap.appendChild(h); if(q.type==='mc'){ q.choices.forEach((c,i)=>{ const row=document.createElement('label'); row.className='opt'; const radio=document.createElement('input'); radio.type='radio'; radio.name='mc'; radio.value=i; radio.checked = ans?.choice===i; radio.onchange=()=>gradeMC(i); const span=document.createElement('div'); span.textContent=c; row.appendChild(radio); row.appendChild(span); qWrap.appendChild(row); if(ans){ if(i===q.answer){ row.style.borderColor='rgba(26,213,152,.9)'; } if(ans.choice===i && i!==q.answer){ row.style.borderColor='rgba(255,90,122,.9)'; } } }); } const exp=document.createElement('div'); exp.className='muted'; exp.style.marginTop='8px'; if(ans && q.explain){ exp.innerHTML = `<strong>Why:</strong> ${q.explain}`; } qWrap.appendChild(exp); screen.appendChild(qWrap); $('prevBtn').disabled = state.qIndex===0; $('nextBtn').disabled = state.qIndex===sec.questions.length-1; }
function gradeMC(choiceIdx){ const sec=SECTIONS[state.sectionIndex]; const q=sec.questions[state.qIndex]; const key=`${sec.id}:${state.qIndex}`; const correct=(choiceIdx===q.answer); state.answers[key]={graded:true, choice:choiceIdx, correct}; render(); }

// ========= NAV + TIMERS =========
$('prevBtn').onclick=()=>{ if(state.qIndex>0){ state.qIndex--; render(); } };
$('nextBtn').onclick=()=>{ const sec=SECTIONS[state.sectionIndex]; if(state.qIndex<sec.questions.length-1){ state.qIndex++; render(); } };
$('finishBtn').onclick=()=> showSummary(); $('saveBtn').onclick=()=> saveProgress(true); $('resumeBtn').onclick=()=> resumeNow(); $('resumeNow').onclick=()=> resumeNow(); $('startOver').onclick=()=> resetAll();
function resumeNow(){ const saved=tryLoadSaved(); if(saved){ applySaved(saved,true); render(); tick(); }}
function tick(){ if(!state.running) return; const now=Date.now(); const dt = Math.max(0, now - state.lastTick); state.lastTick = now; state.remainingMs[state.sectionIndex] = Math.max(0, state.remainingMs[state.sectionIndex] - dt); if(state.remainingMs[state.sectionIndex]===0){ if(state.sectionIndex < SECTIONS.length-1){ state.sectionIndex++; state.qIndex=0; renderTabs(); } else { showSummary(true); return; } } $('totalTimer').textContent = fmt(sumRemaining()); $('sectionTimer').textContent = fmt(state.remainingMs[state.sectionIndex]); requestAnimationFrame(tick); }

// ========= SUMMARY =========
function showSummary(timeUp=false){ state.running=false; const screen=$('screen'); screen.innerHTML=''; $('navControls').style.display='none'; const wrapper=document.createElement('div'); wrapper.className='summary'; const totalQ = SECTIONS.reduce((a,s)=>a+s.questions.length,0); const correct = Object.values(state.answers).filter(a=>a.correct).length; const percent = Math.round((correct/totalQ)*100); const h2=document.createElement('h2'); h2.textContent = timeUp? 'Time! Results & Review':'Results & Review'; wrapper.appendChild(h2); const stats=document.createElement('div'); stats.innerHTML = `<span class="stat">Score: <strong>${correct}/${totalQ}</strong> (${percent}%)</span>` + SECTIONS.map((sec,i)=>{ const keys = Object.keys(state.answers).filter(k=>k.startsWith(sec.id+':')); const c = keys.filter(k=>state.answers[k]?.correct).length; return ` <span class="stat">${i+1}. ${sec.label}: <strong>${c}/${sec.questions.length}</strong></span>`; }).join(''); wrapper.appendChild(stats); const misses=[]; SECTIONS.forEach((sec)=>{ sec.questions.forEach((q,idx)=>{ const k=`${sec.id}:${idx}`; const a=state.answers[k]; if(!a || !a.correct){ misses.push({sec, q, idx, a}); } }) }); if(misses.length){ const t=document.createElement('h3'); t.textContent='Missed or Unanswered Questions'; wrapper.appendChild(t); misses.forEach(m=>{ const div=document.createElement('div'); div.className='miss'; const chosen = m.a?.choice!=null ? m.q.choices?.[m.a.choice] : '(no answer)'; const correctText = m.q.choices[m.q.answer]; div.innerHTML = `<strong>Section:</strong> ${m.sec.label}<br><strong>Question:</strong> ${m.q.prompt}<br><strong>Your answer:</strong> ${chosen}<br><strong>Correct:</strong> ${correctText}${m.q.explain? `<br><em>Why:</em> ${m.q.explain}`:''}`; wrapper.appendChild(div); }); }
  const actions=document.createElement('div'); actions.className='row'; const restart=document.createElement('button'); restart.className='ghost'; restart.textContent='Start a New Attempt'; restart.onclick=()=>{ resetAll(); }; const saveRep=document.createElement('button'); saveRep.className='primary'; saveRep.textContent='Save Results'; saveRep.onclick=()=>{ saveProgress(true); }; actions.appendChild(restart); actions.appendChild(saveRep); wrapper.appendChild(actions); screen.appendChild(wrapper); }

// ========= BOOT =========
window.addEventListener('beforeunload', ()=>{ if(state.running){ saveProgress(true); } });
init();
</script>
</body>
</html>
